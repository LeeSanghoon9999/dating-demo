var R=Object.defineProperty;var u=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var s=(e,n,t)=>n in e?R(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,c=(e,n)=>{for(var t in n||(n={}))x.call(n,t)&&s(e,t,n[t]);if(u)for(var t of u(n))A.call(n,t)&&s(e,t,n[t]);return e};import{makeTemplate as E,normalizeRoute as g,useRoutes as K}from"@stackflow/plugin-history-sync";import{usePreloader as N}from"@stackflow/plugin-preload";import{useActions as b}from"@stackflow/react";import v,{useEffect as C,useMemo as M,useReducer as w,useRef as H}from"react";var y=(...e)=>{let n=e.filter(t=>!!t);return n.length?n.length===0?n[0]:t=>{n.forEach(a=>{typeof a=="function"?a(t):a&&(a.current=t)})}:null};function d(e,n){let t=c({},e);return n.forEach(a=>{delete t[a]}),t}var T=v.forwardRef((e,n)=>{let t=K(),{preload:a}=N(),{push:h,replace:k}=b(),i=H(null),[p,m]=w(()=>!0,!1),f=M(()=>{let r=t[e.activityName];return r?E(g(r)[0]).fill(e.activityParams):void 0},[t,e.activityName,e.activityParams]);C(()=>{if(p||!i.current)return()=>{};let r=i.current,o=new IntersectionObserver(([{isIntersecting:l}])=>{l&&(a(e.activityName,e.activityParams,{activityContext:{path:f}}),m())});return o.observe(r),()=>{o.unobserve(r),o.disconnect()}},[i,m]);let L=d(e,["activityName","activityParams","animate","onClick"]),P=r=>{e.onClick&&e.onClick(r),(r.button===0&&!(r.currentTarget.target&&r.currentTarget.target!=="_self")||!r.defaultPrevented&&!r.metaKey&&!r.altKey&&!r.ctrlKey&&!r.shiftKey&&!(r.nativeEvent&&r.nativeEvent.which===2))&&(r.preventDefault(),e.replace?k(e.activityName,e.activityParams,typeof e.animate=="undefined"||e.animate===null?{}:{animate:e.animate}):h(e.activityName,e.activityParams,typeof e.animate=="undefined"||e.animate===null?{}:{animate:e.animate}))};return v.createElement("a",c({ref:y(n,i),href:f,onClick:P},L),e.children)});function G(){return{Link:T}}export{T as Link,G as createLinkComponent};
//# sourceMappingURL=index.mjs.map
