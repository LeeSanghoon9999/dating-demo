{
  "version": 3,
  "sources": ["../src/index.ts", "../src/Link.tsx", "../src/mergeRefs.ts", "../src/omit.ts", "../src/createLinkComponent.tsx"],
  "sourcesContent": ["export * from \"./createLinkComponent\";\nexport * from \"./Link\";\n", "import {\n  makeTemplate,\n  normalizeRoute,\n  useRoutes,\n} from \"@stackflow/plugin-history-sync\";\nimport { usePreloader } from \"@stackflow/plugin-preload\";\nimport type { ActivityComponentType } from \"@stackflow/react\";\nimport { useActions } from \"@stackflow/react\";\nimport React, { useEffect, useMemo, useReducer, useRef } from \"react\";\n\nimport { mergeRefs } from \"./mergeRefs\";\nimport { omit } from \"./omit\";\n\nexport type AnchorProps = Omit<\n  React.DetailedHTMLProps<\n    React.AnchorHTMLAttributes<HTMLAnchorElement>,\n    HTMLAnchorElement\n  >,\n  \"ref\" | \"href\"\n>;\n\nexport type LinkProps<K, P> = {\n  activityName: K;\n  activityParams: P;\n  animate?: boolean;\n  replace?: boolean;\n} & AnchorProps;\n\nexport type TypeLink<T extends { [activityName: string]: unknown } = {}> = <\n  K extends Extract<keyof T, string>,\n>(\n  props: LinkProps<K, T[K] extends ActivityComponentType<infer U> ? U : never>,\n) => React.ReactElement | null;\n\nexport const Link: TypeLink = React.forwardRef(\n  (props, ref: React.ForwardedRef<HTMLAnchorElement>) => {\n    const routes = useRoutes();\n    const { preload } = usePreloader();\n    const { push, replace } = useActions();\n\n    const anchorRef = useRef<HTMLAnchorElement>(null);\n    const [preloaded, flagPreloaded] = useReducer(() => true, false);\n\n    const href = useMemo(() => {\n      const route = routes[props.activityName];\n\n      if (!route) {\n        return undefined;\n      }\n\n      const template = makeTemplate(normalizeRoute(route)[0]);\n      const path = template.fill(props.activityParams);\n\n      return path;\n    }, [routes, props.activityName, props.activityParams]);\n\n    useEffect(() => {\n      if (preloaded || !anchorRef.current) {\n        return () => {};\n      }\n\n      const $anchor = anchorRef.current;\n\n      const observer = new IntersectionObserver(([{ isIntersecting }]) => {\n        if (isIntersecting) {\n          preload(props.activityName, props.activityParams, {\n            activityContext: {\n              path: href,\n            },\n          });\n          flagPreloaded();\n        }\n      });\n\n      observer.observe($anchor);\n\n      return () => {\n        observer.unobserve($anchor);\n        observer.disconnect();\n      };\n    }, [anchorRef, flagPreloaded]);\n\n    const anchorProps = omit(props, [\n      \"activityName\",\n      \"activityParams\",\n      \"animate\",\n      \"onClick\",\n    ]);\n\n    const onClick = (e: React.MouseEvent<HTMLAnchorElement>) => {\n      if (props.onClick) {\n        props.onClick(e);\n      }\n\n      if (\n        (e.button === 0 &&\n          !(e.currentTarget.target && e.currentTarget.target !== \"_self\")) ||\n        (!e.defaultPrevented &&\n          !e.metaKey &&\n          !e.altKey && // triggers resource download\n          !e.ctrlKey &&\n          !e.shiftKey &&\n          !(e.nativeEvent && e.nativeEvent.which === 2))\n      ) {\n        e.preventDefault();\n\n        if (props.replace) {\n          replace(\n            props.activityName,\n            props.activityParams,\n            typeof props.animate === \"undefined\" || props.animate === null\n              ? {}\n              : { animate: props.animate },\n          );\n        } else {\n          push(\n            props.activityName,\n            props.activityParams,\n            typeof props.animate === \"undefined\" || props.animate === null\n              ? {}\n              : { animate: props.animate },\n          );\n        }\n      }\n    };\n\n    return (\n      <a\n        ref={mergeRefs(ref, anchorRef)}\n        href={href}\n        onClick={onClick}\n        {...anchorProps}\n      >\n        {props.children}\n      </a>\n    );\n  },\n);\n", "export const mergeRefs = <T>(...refs: Array<React.ForwardedRef<T>>) => {\n  const filteredRefs = refs.filter(\n    (ref): ref is NonNullable<typeof ref> => !!ref,\n  );\n\n  if (!filteredRefs.length) {\n    return null;\n  }\n\n  if (filteredRefs.length === 0) {\n    return filteredRefs[0];\n  }\n\n  return (inst: T) => {\n    filteredRefs.forEach((ref) => {\n      if (typeof ref === \"function\") {\n        ref(inst);\n      } else if (ref) {\n        // eslint-disable-next-line no-param-reassign\n        ref.current = inst;\n      }\n    });\n  };\n};\n", "export function omit<T extends {}, K extends keyof T>(\n  obj: T,\n  fieldNames: K[],\n): Omit<T, K> {\n  const output = { ...obj };\n\n  fieldNames.forEach((fieldName) => {\n    delete output[fieldName];\n  });\n\n  return output;\n}\n", "import type { TypeLink } from \"./Link\";\nimport { Link } from \"./Link\";\n\nexport function createLinkComponent<\n  T extends { [activityName: string]: unknown },\n>(): {\n  Link: TypeLink<T>;\n} {\n  return {\n    Link,\n  };\n}\n"],
  "mappings": "y0BAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,UAAAE,EAAA,wBAAAC,IAAA,eAAAC,EAAAJ,GCAA,IAAAK,EAIO,0CACPC,EAA6B,qCAE7BC,EAA2B,4BAC3BA,EAA8D,oBCRvD,IAAMC,EAAY,IAAOC,IAAuC,CACrE,IAAMC,EAAeD,EAAK,OACvBE,GAAwC,CAAC,CAACA,CAC7C,EAEA,OAAKD,EAAa,OAIdA,EAAa,SAAW,EACnBA,EAAa,GAGdE,GAAY,CAClBF,EAAa,QAASC,GAAQ,CACxB,OAAOA,GAAQ,WACjBA,EAAIC,CAAI,EACCD,IAETA,EAAI,QAAUC,EAElB,CAAC,CACH,EAhBS,IAiBX,ECvBO,SAASC,EACdC,EACAC,EACY,CACZ,IAAMC,EAASC,EAAA,GAAKH,GAEpB,OAAAC,EAAW,QAASG,GAAc,CAChC,OAAOF,EAAOE,EAChB,CAAC,EAEMF,CACT,CFuBO,IAAMG,EAAiB,EAAAC,QAAM,WAClC,CAACC,EAAOC,IAA+C,CACrD,IAAMC,KAAS,aAAU,EACnB,CAAE,QAAAC,CAAQ,KAAI,gBAAa,EAC3B,CAAE,KAAAC,EAAM,QAAAC,CAAQ,KAAI,cAAW,EAE/BC,KAAY,UAA0B,IAAI,EAC1C,CAACC,EAAWC,CAAa,KAAI,cAAW,IAAM,GAAM,EAAK,EAEzDC,KAAO,WAAQ,IAAM,CACzB,IAAMC,EAAQR,EAAOF,EAAM,cAE3B,OAAKU,KAIY,mBAAa,kBAAeA,CAAK,EAAE,EAAE,EAChC,KAAKV,EAAM,cAAc,EAJ7C,MAOJ,EAAG,CAACE,EAAQF,EAAM,aAAcA,EAAM,cAAc,CAAC,KAErD,aAAU,IAAM,CACd,GAAIO,GAAa,CAACD,EAAU,QAC1B,MAAO,IAAM,CAAC,EAGhB,IAAMK,EAAUL,EAAU,QAEpBM,EAAW,IAAI,qBAAqB,CAAC,CAAC,CAAE,eAAAC,CAAe,CAAC,IAAM,CAC9DA,IACFV,EAAQH,EAAM,aAAcA,EAAM,eAAgB,CAChD,gBAAiB,CACf,KAAMS,CACR,CACF,CAAC,EACDD,EAAc,EAElB,CAAC,EAED,OAAAI,EAAS,QAAQD,CAAO,EAEjB,IAAM,CACXC,EAAS,UAAUD,CAAO,EAC1BC,EAAS,WAAW,CACtB,CACF,EAAG,CAACN,EAAWE,CAAa,CAAC,EAE7B,IAAMM,EAAcC,EAAKf,EAAO,CAC9B,eACA,iBACA,UACA,SACF,CAAC,EAEKgB,EAAWC,GAA2C,CACtDjB,EAAM,SACRA,EAAM,QAAQiB,CAAC,GAIdA,EAAE,SAAW,GACZ,EAAEA,EAAE,cAAc,QAAUA,EAAE,cAAc,SAAW,UACxD,CAACA,EAAE,kBACF,CAACA,EAAE,SACH,CAACA,EAAE,QACH,CAACA,EAAE,SACH,CAACA,EAAE,UACH,EAAEA,EAAE,aAAeA,EAAE,YAAY,QAAU,MAE7CA,EAAE,eAAe,EAEbjB,EAAM,QACRK,EACEL,EAAM,aACNA,EAAM,eACN,OAAOA,EAAM,SAAY,aAAeA,EAAM,UAAY,KACtD,CAAC,EACD,CAAE,QAASA,EAAM,OAAQ,CAC/B,EAEAI,EACEJ,EAAM,aACNA,EAAM,eACN,OAAOA,EAAM,SAAY,aAAeA,EAAM,UAAY,KACtD,CAAC,EACD,CAAE,QAASA,EAAM,OAAQ,CAC/B,EAGN,EAEA,OACE,EAAAD,QAAA,cAAC,IAAAmB,EAAA,CACC,IAAKC,EAAUlB,EAAKK,CAAS,EAC7B,KAAMG,EACN,QAASO,GACLF,GAEHd,EAAM,QACT,CAEJ,CACF,EGtIO,SAASoB,GAId,CACA,MAAO,CACL,KAAAC,CACF,CACF",
  "names": ["src_exports", "__export", "Link", "createLinkComponent", "__toCommonJS", "import_plugin_history_sync", "import_plugin_preload", "import_react", "mergeRefs", "refs", "filteredRefs", "ref", "inst", "omit", "obj", "fieldNames", "output", "__spreadValues", "fieldName", "Link", "React", "props", "ref", "routes", "preload", "push", "replace", "anchorRef", "preloaded", "flagPreloaded", "href", "route", "$anchor", "observer", "isIntersecting", "anchorProps", "omit", "onClick", "e", "__spreadValues", "mergeRefs", "createLinkComponent", "Link"]
}
