var v=Object.defineProperty,P=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var m=(t,e,r)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,c=(t,e)=>{for(var r in e||(e={}))T.call(e,r)&&m(t,r,e[r]);if(p)for(var r of p(e))C.call(e,r)&&m(t,r,e[r]);return t},s=(t,e)=>P(t,L(e));import{makeTemplate as w,normalizeRoute as N,useRoutes as A}from"@stackflow/plugin-history-sync";import{useMemo as h}from"react";import k,{createContext as g,useContext as R}from"react";var y=g({}),f=t=>k.createElement(y.Provider,{value:t.loaders},t.children);function l(){return R(y)}function x(){let t=l(),e=A();return h(()=>({preload(r,o,d){let a=t[r];if(!a)return null;let n=e[r],i=n?w(N(n)[0]):void 0,u=i==null?void 0:i.fill(o);return a({activityParams:o,activityContext:c(c({},u?{path:u}:null),d==null?void 0:d.activityContext)})}}),[t])}function b(){return{usePreloader:x}}import F from"react";function G(t){return()=>({key:"plugin-preload",wrapStack({stack:e}){return F.createElement(f,{loaders:t.loaders},e.render())},overrideInitialEvents({initialEvents:e,initialContext:r}){return e.length===0?[]:e.map(o=>{if(o.name!=="Pushed")return o;let{activityName:d,activityParams:a,activityContext:n}=o,i=t.loaders[d];if(!i)return o;let u=i({activityParams:a,activityContext:n,isInitialActivity:!0,initialContext:r});return s(c({},o),{activityContext:s(c({},o.activityContext),{preloadRef:u})})})},onBeforePush({actionParams:e,actions:{overrideActionParams:r}}){let{activityName:o,activityParams:d,activityContext:a}=e,n=t.loaders[o];if(!n)return;let i=n({activityParams:d,activityContext:a});r(s(c({},e),{activityContext:s(c({},a),{preloadRef:i})}))},onBeforeReplace({actionParams:e,actions:{overrideActionParams:r}}){let{activityName:o,activityParams:d,activityContext:a}=e,n=t.loaders[o];if(!n)return;let i=n({activityParams:d,activityContext:a});r(s(c({},e),{activityContext:s(c({},a),{preloadRef:i})}))}})}import{useActivity as M}from"@stackflow/react";function Q(){let e=M().context;return e==null?void 0:e.preloadRef}export{b as createPreloader,G as preloadPlugin,Q as useActivityPreloadRef,l as useLoaders,x as usePreloader};
//# sourceMappingURL=index.mjs.map
