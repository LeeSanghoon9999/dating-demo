var nt=Object.defineProperty,at=Object.defineProperties;var st=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,pt=Object.prototype.propertyIsEnumerable;var j=(t,e,o)=>e in t?nt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,m=(t,e)=>{for(var o in e||(e={}))ct.call(e,o)&&j(t,o,e[o]);if(W)for(var o of W(e))pt.call(e,o)&&j(t,o,e[o]);return t},f=(t,e)=>at(t,st(e));import{useContext as dt}from"react";import ft,{createContext as vt}from"react";import{useEffect as ut,useRef as mt}from"react";import lt from"react-fast-compare";function C(t){let e=mt(t),o=e.current,a=lt(o,t);return ut(()=>{a||(e.current=t)}),a?o:t}var k=vt(null),z=({children:t,value:e})=>ft.createElement(k.Provider,{value:C(e)},t);var ie=()=>dt(k);import{useContext as yt}from"react";function ae(){return yt(k).params}import{useContext as xt}from"react";import St,{createContext as At}from"react";var I=At(null),$=({children:t,value:e})=>St.createElement(I.Provider,{value:C(e)},t);var fe=()=>xt(I);import{aggregate as qt,createCoreStore as Wt,makeEvent as F}from"@stackflow/core";import E,{useEffect as jt,useMemo as zt}from"react";import{id as Pt}from"@stackflow/core";function v(){return Pt()}import{id as kt}from"@stackflow/core";function A(){return kt()}import Q,{createContext as X}from"react";import gt from"react";var G,H=(G=gt.useDeferredValue)!=null?G:t=>t;import Ct,{useEffect as Tt,useState as Rt}from"react";var J,L=(J=Ct.useSyncExternalStore)!=null?J:(t,e)=>{let[o,a]=Rt(()=>e());return Tt(()=>t(()=>{a(()=>e())})),o};var U=X(null),B=X(null),Y=({coreStore:t,children:e})=>{let o=L(t.subscribe,t.actions.getStack,t.actions.getStack),a=H(o);return Q.createElement(B.Provider,{value:a},Q.createElement(U.Provider,{value:t.actions},e))};import ht from"react";var T=()=>ht.useContext(U);import wt from"react";var R=()=>wt.useContext(B);import b,{useEffect as Bt}from"react";import w from"react";import Et,{createContext as Ot}from"react";var D=Ot(null),Z=({children:t,value:e})=>Et.createElement(D.Provider,{value:e},t);import{useContext as It}from"react";function h(){return It(D)}var Ut=({activities:t,plugin:e})=>{let o=R(),a=h();return e.render({stack:f(m({},o),{render(c){let s=m(m({},o),c);return{activities:s.activities.map(p=>f(m({},p),{key:p.id,render(u){let g=t[p.name],y;if("component"in g){let{component:d}=g;y=w.createElement(d,{params:p.params})}else y=w.createElement(g,{params:p.params});return a.forEach(d=>{var i,n;y=(n=(i=d.wrapActivity)==null?void 0:i.call(d,{activity:f(m({},p),{render:()=>y})}))!=null?n:y}),w.createElement($,{value:s},w.createElement(z,{key:p.id,value:m(m({},p),u)},y))}}))}}})})},_=Ut;var Dt=({activities:t})=>{let e=R(),o=h(),a=o.filter(s=>!!s.render);Bt(()=>{a.length===0&&console.warn(`Stackflow - There is no rendering plugin, so "<Stack />" doesn't render anything. If you want to render some UI, use "@stackflow/plugin-renderer-basic" or add another rendering plugin.`)},[a]);let c=b.createElement(b.Fragment,null,a.map(s=>b.createElement(_,{key:s.key,activities:t,plugin:s})));return o.forEach(s=>{var p,u;c=(u=(p=s.wrapStack)==null?void 0:p.call(s,{stack:f(m({},e),{render(){return c}})}))!=null?u:c}),c},tt=Dt;import bt,{useMemo as Nt}from"react";function N(t){return t?t.animate===void 0||t.animate==null?{skipActiveState:!1}:{skipActiveState:!t.animate}:{skipActiveState:!1}}var et,Ft=(et=bt.useTransition)!=null?et:()=>[!1,t=>t()];function it(){let t=T(),[e,o]=Ft();return Nt(()=>({pending:e,push(a,c,s){let p=v();return t.push({activityId:p,activityName:a,activityParams:c,skipEnterActiveState:N(s).skipActiveState}),{activityId:p}},replace(a,c,s){var u;let p=v();return t.replace({activityId:(u=s==null?void 0:s.activityId)!=null?u:v(),activityName:a,activityParams:c,skipEnterActiveState:N(s).skipActiveState}),{activityId:p}},pop(a){t.pop({skipExitActiveState:N(a).skipActiveState})}}),[t.push,t.replace,t.pop,e,o])}import Mt,{useMemo as Kt}from"react";var ot,Vt=(ot=Mt.useTransition)!=null?ot:()=>[!1,t=>t()],rt=()=>{let t=T(),[e,o]=Vt();return Kt(()=>({pending:e,stepPush(a){let c=A();t.stepPush({stepId:c,stepParams:a})},stepReplace(a){let c=A();t.stepReplace({stepId:c,stepParams:a})},stepPop(){t.stepPop({})}}),[t.stepPush,t.stepReplace,t.stepPop,e,o])};function M(t){return t?t.animate===void 0||t.animate==null?{skipActiveState:!1}:{skipActiveState:!t.animate}:{skipActiveState:!1}}function Ii(t){var d;let e=((d=t.plugins)!=null?d:[]).flat(1/0).map(i=>i),o=e.map(i=>i()),a=Object.entries(t.activities).reduce((i,[n,r])=>"component"in r?f(m({},i),{[n]:{paramsSchema:r.paramsSchema,component:r.component}}):f(m({},i),{[n]:E.memo(r)}),{}),c=()=>new Date().getTime()-t.transitionDuration,s=()=>{let i=F("Initialized",{transitionDuration:t.transitionDuration,eventDate:c()}),n=Object.entries(a).map(([r,l])=>F("ActivityRegistered",m({activityName:r,eventDate:c()},"component"in l?{activityParamsSchema:l.paramsSchema}:null)));return[i,...n]},p=qt(s(),new Date().getTime()),u={value:null};return typeof window!="undefined"&&window.document.documentElement.style.setProperty("--stackflow-transition-duration",`${t.transitionDuration}ms`),{Stack:i=>{let n=zt(()=>{let r=t.initialActivity?[F("Pushed",{activityId:v(),activityName:t.initialActivity(),activityParams:{},eventDate:c(),skipEnterActiveState:!1})]:[],l=o.reduce((P,O)=>{var K,V,q;return(q=(V=O.overrideInitialEvents)==null?void 0:V.call(O,{initialEvents:P,initialContext:(K=i.initialContext)!=null?K:{}}))!=null?q:P},r);l.length>0&&r.length>0&&l!==r&&console.warn(`Stackflow -  Some plugin overrides an "initialActivity" option. The "initialActivity" option you set to "${r[0].activityName}" in the "stackflow" is ignored.`),l.length===0&&console.warn("Stackflow -  There is no initial activity. If you want to set the initial activity, add the `initialActivity` option of the `stackflow()` function or add a plugin that sets the initial activity. (e.g. `@stackflow/plugin-history-sync`)");let x=Wt({initialEvents:[...s(),...l],plugins:e});return u.value=x,x},[]);return jt(()=>{n.init()},[n]),E.createElement(Z,{value:o},E.createElement(Y,{coreStore:n},E.createElement(tt,{activities:a})))},useFlow:it,useStepFlow:rt,actions:{dispatchEvent(i,n){var r;return(r=u.value)==null?void 0:r.actions.dispatchEvent(i,n)},getStack(){var i,n;return(n=(i=u.value)==null?void 0:i.actions.getStack())!=null?n:p},push(i,n,r){var S;let l=v();return(S=u.value)==null||S.actions.push({activityId:l,activityName:i,activityParams:n,skipEnterActiveState:M(r).skipActiveState}),{activityId:l}},replace(i,n,r){var S,x,P;let l=(S=r==null?void 0:r.activityId)!=null?S:v();return(P=u.value)==null||P.actions.replace({activityId:(x=r==null?void 0:r.activityId)!=null?x:v(),activityName:i,activityParams:n,skipEnterActiveState:M(r).skipActiveState}),{activityId:l}},pop(i){var n;return(n=u.value)==null?void 0:n.actions.pop({skipExitActiveState:M(i).skipActiveState})},stepPush(i){var r;let n=A();return(r=u.value)==null?void 0:r.actions.stepPush({stepId:n,stepParams:i})},stepReplace(i){var r;let n=A();return(r=u.value)==null?void 0:r.actions.stepReplace({stepId:n,stepParams:i})},stepPop(){var i;return(i=u.value)==null?void 0:i.actions.stepPop({})}},activities:a}}export{Ii as stackflow,it as useActions,ie as useActivity,ae as useActivityParams,fe as useStack,rt as useStepActions};
//# sourceMappingURL=index.mjs.map
