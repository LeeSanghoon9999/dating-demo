"use strict";var Rt=Object.create;var w=Object.defineProperty,ht=Object.defineProperties,wt=Object.getOwnPropertyDescriptor,Et=Object.getOwnPropertyDescriptors,Ot=Object.getOwnPropertyNames,_=Object.getOwnPropertySymbols,It=Object.getPrototypeOf,et=Object.prototype.hasOwnProperty,Ut=Object.prototype.propertyIsEnumerable;var tt=(t,e,i)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,m=(t,e)=>{for(var i in e||(e={}))et.call(e,i)&&tt(t,i,e[i]);if(_)for(var i of _(e))Ut.call(e,i)&&tt(t,i,e[i]);return t},v=(t,e)=>ht(t,Et(e));var Bt=(t,e)=>{for(var i in e)w(t,i,{get:e[i],enumerable:!0})},it=(t,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ot(e))!et.call(t,s)&&s!==i&&w(t,s,{get:()=>e[s],enumerable:!(n=wt(e,s))||n.enumerable});return t};var l=(t,e,i)=>(i=t!=null?Rt(It(t)):{},it(e||!t||!t.__esModule?w(i,"default",{value:t,enumerable:!0}):i,t)),Dt=t=>it(w({},"__esModule",{value:!0}),t);var jt={};Bt(jt,{stackflow:()=>Wt,useActions:()=>J,useActivity:()=>bt,useActivityParams:()=>Nt,useStack:()=>Ft,useStepActions:()=>L});module.exports=Dt(jt);var nt=require("react");var D=l(require("react"));var U=require("react"),ot=l(require("react-fast-compare"));function B(t){let e=(0,U.useRef)(t),i=e.current,n=(0,ot.default)(i,t);return(0,U.useEffect)(()=>{n||(e.current=t)}),n?i:t}var E=(0,D.createContext)(null),rt=({children:t,value:e})=>D.default.createElement(E.Provider,{value:B(e)},t);var bt=()=>(0,nt.useContext)(E);var at=require("react");function Nt(){return(0,at.useContext)(E).params}var ct=require("react");var b=l(require("react"));var j=(0,b.createContext)(null),st=({children:t,value:e})=>b.default.createElement(j.Provider,{value:B(e)},t);var Ft=()=>(0,ct.useContext)(j);var A=require("@stackflow/core"),y=l(require("react"));var pt=require("@stackflow/core");function d(){return(0,pt.id)()}var ut=require("@stackflow/core");function k(){return(0,ut.id)()}var C=l(require("react"));var lt=l(require("react")),mt,ft=(mt=lt.default.useDeferredValue)!=null?mt:t=>t;var g=l(require("react")),vt,dt=(vt=g.default.useSyncExternalStore)!=null?vt:(t,e)=>{let[i,n]=(0,g.useState)(()=>e());return(0,g.useEffect)(()=>t(()=>{n(()=>e())})),i};var z=(0,C.createContext)(null),$=(0,C.createContext)(null),yt=({coreStore:t,children:e})=>{let i=dt(t.subscribe,t.actions.getStack,t.actions.getStack),n=ft(i);return C.default.createElement($.Provider,{value:n},C.default.createElement(z.Provider,{value:t.actions},e))};var St=l(require("react"));var N=()=>St.default.useContext(z);var At=l(require("react"));var F=()=>At.default.useContext($);var T=l(require("react"));var O=l(require("react"));var M=l(require("react")),G=(0,M.createContext)(null),xt=({children:t,value:e})=>M.default.createElement(G.Provider,{value:e},t);var Pt=require("react");function K(){return(0,Pt.useContext)(G)}var Mt=({activities:t,plugin:e})=>{let i=F(),n=K();return e.render({stack:v(m({},i),{render(s){let c=m(m({},i),s);return{activities:c.activities.map(p=>v(m({},p),{key:p.id,render(u){let I=t[p.name],x;if("component"in I){let{component:S}=I;x=O.default.createElement(S,{params:p.params})}else x=O.default.createElement(I,{params:p.params});return n.forEach(S=>{var o,a;x=(a=(o=S.wrapActivity)==null?void 0:o.call(S,{activity:v(m({},p),{render:()=>x})}))!=null?a:x}),O.default.createElement(st,{value:c},O.default.createElement(rt,{key:p.id,value:m(m({},p),u)},x))}}))}}})})},kt=Mt;var Kt=({activities:t})=>{let e=F(),i=K(),n=i.filter(c=>!!c.render);(0,T.useEffect)(()=>{n.length===0&&console.warn(`Stackflow - There is no rendering plugin, so "<Stack />" doesn't render anything. If you want to render some UI, use "@stackflow/plugin-renderer-basic" or add another rendering plugin.`)},[n]);let s=T.default.createElement(T.default.Fragment,null,n.map(c=>T.default.createElement(kt,{key:c.key,activities:t,plugin:c})));return i.forEach(c=>{var p,u;s=(u=(p=c.wrapStack)==null?void 0:p.call(c,{stack:v(m({},e),{render(){return s}})}))!=null?u:s}),s},gt=Kt;var V=l(require("react"));function H(t){return t?t.animate===void 0||t.animate==null?{skipActiveState:!1}:{skipActiveState:!t.animate}:{skipActiveState:!1}}var Ct,Vt=(Ct=V.default.useTransition)!=null?Ct:()=>[!1,t=>t()];function J(){let t=N(),[e,i]=Vt();return(0,V.useMemo)(()=>({pending:e,push(n,s,c){let p=d();return t.push({activityId:p,activityName:n,activityParams:s,skipEnterActiveState:H(c).skipActiveState}),{activityId:p}},replace(n,s,c){var u;let p=d();return t.replace({activityId:(u=c==null?void 0:c.activityId)!=null?u:d(),activityName:n,activityParams:s,skipEnterActiveState:H(c).skipActiveState}),{activityId:p}},pop(n){t.pop({skipExitActiveState:H(n).skipActiveState})}}),[t.push,t.replace,t.pop,e,i])}var q=l(require("react"));var Tt,qt=(Tt=q.default.useTransition)!=null?Tt:()=>[!1,t=>t()],L=()=>{let t=N(),[e,i]=qt();return(0,q.useMemo)(()=>({pending:e,stepPush(n){let s=k();t.stepPush({stepId:s,stepParams:n})},stepReplace(n){let s=k();t.stepReplace({stepId:s,stepParams:n})},stepPop(){t.stepPop({})}}),[t.stepPush,t.stepReplace,t.stepPop,e,i])};function Q(t){return t?t.animate===void 0||t.animate==null?{skipActiveState:!1}:{skipActiveState:!t.animate}:{skipActiveState:!1}}function Wt(t){var S;let e=((S=t.plugins)!=null?S:[]).flat(1/0).map(o=>o),i=e.map(o=>o()),n=Object.entries(t.activities).reduce((o,[a,r])=>"component"in r?v(m({},o),{[a]:{paramsSchema:r.paramsSchema,component:r.component}}):v(m({},o),{[a]:y.default.memo(r)}),{}),s=()=>new Date().getTime()-t.transitionDuration,c=()=>{let o=(0,A.makeEvent)("Initialized",{transitionDuration:t.transitionDuration,eventDate:s()}),a=Object.entries(n).map(([r,f])=>(0,A.makeEvent)("ActivityRegistered",m({activityName:r,eventDate:s()},"component"in f?{activityParamsSchema:f.paramsSchema}:null)));return[o,...a]},p=(0,A.aggregate)(c(),new Date().getTime()),u={value:null};return typeof window!="undefined"&&window.document.documentElement.style.setProperty("--stackflow-transition-duration",`${t.transitionDuration}ms`),{Stack:o=>{let a=(0,y.useMemo)(()=>{let r=t.initialActivity?[(0,A.makeEvent)("Pushed",{activityId:d(),activityName:t.initialActivity(),activityParams:{},eventDate:s(),skipEnterActiveState:!1})]:[],f=i.reduce((h,W)=>{var X,Y,Z;return(Z=(Y=W.overrideInitialEvents)==null?void 0:Y.call(W,{initialEvents:h,initialContext:(X=o.initialContext)!=null?X:{}}))!=null?Z:h},r);f.length>0&&r.length>0&&f!==r&&console.warn(`Stackflow -  Some plugin overrides an "initialActivity" option. The "initialActivity" option you set to "${r[0].activityName}" in the "stackflow" is ignored.`),f.length===0&&console.warn("Stackflow -  There is no initial activity. If you want to set the initial activity, add the `initialActivity` option of the `stackflow()` function or add a plugin that sets the initial activity. (e.g. `@stackflow/plugin-history-sync`)");let R=(0,A.createCoreStore)({initialEvents:[...c(),...f],plugins:e});return u.value=R,R},[]);return(0,y.useEffect)(()=>{a.init()},[a]),y.default.createElement(xt,{value:i},y.default.createElement(yt,{coreStore:a},y.default.createElement(gt,{activities:n})))},useFlow:J,useStepFlow:L,actions:{dispatchEvent(o,a){var r;return(r=u.value)==null?void 0:r.actions.dispatchEvent(o,a)},getStack(){var o,a;return(a=(o=u.value)==null?void 0:o.actions.getStack())!=null?a:p},push(o,a,r){var P;let f=d();return(P=u.value)==null||P.actions.push({activityId:f,activityName:o,activityParams:a,skipEnterActiveState:Q(r).skipActiveState}),{activityId:f}},replace(o,a,r){var P,R,h;let f=(P=r==null?void 0:r.activityId)!=null?P:d();return(h=u.value)==null||h.actions.replace({activityId:(R=r==null?void 0:r.activityId)!=null?R:d(),activityName:o,activityParams:a,skipEnterActiveState:Q(r).skipActiveState}),{activityId:f}},pop(o){var a;return(a=u.value)==null?void 0:a.actions.pop({skipExitActiveState:Q(o).skipActiveState})},stepPush(o){var r;let a=k();return(r=u.value)==null?void 0:r.actions.stepPush({stepId:a,stepParams:o})},stepReplace(o){var r;let a=k();return(r=u.value)==null?void 0:r.actions.stepReplace({stepId:a,stepParams:o})},stepPop(){var o;return(o=u.value)==null?void 0:o.actions.stepPop({})}},activities:n}}
//# sourceMappingURL=index.js.map
